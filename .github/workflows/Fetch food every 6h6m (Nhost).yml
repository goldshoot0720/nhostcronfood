name: Fetch food every 6h6m (Nhost)

on:
  schedule:
    - cron: "6 */6 * * *"
  workflow_dispatch:

jobs:
  fetch_food:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch food from Nhost GraphQL
        run: |
          curl -s -X POST "$NHOST_GRAPHQL_URL" \
            -H "Content-Type: application/json" \
            -H "x-hasura-admin-secret: $NHOST_ADMIN_SECRET" \
            -d '{
              "query": "query { food(order_by: { to_date: desc }) { id name amount price shop to_date photo photohash } }"
            }' \
            -o food.json

      - name: Show result
        run: cat food.json
